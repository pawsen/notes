:PROPERTIES:
:ID:       a1b57a39-78a7-4fc0-91a3-546a2a349a52
:END:
#+title: batteries

* Connectors
[[https://en.wikipedia.org/wiki/DC_connector][Wikipedia dc connectors]]

For batteries
- [[https://en.wikipedia.org/wiki/JST_connector][jst]]
  - SM, locking

* Nickel strips
:PROPERTIES:
:ID:       1de1b8e1-6474-4c69-b92e-63cbeea311a9
:END:

** dimensions
According to the table below


#+NAME: fig:amp
#+CAPTION: https://endless-sphere.com/sphere/threads/nickel-strip-ratings.98849/post-1447486


[[attachment:Ampacity (Powestream extrapolation).jpg]]


** Test if it is pure nickel

*** The salt water test - corrosion
Nickel does not corrode easily, unlike steel which loves to rust. Take a piece
of nickel strip and scratch it up aggressively with strong sandpaper or a metal
file. Then mix up a cup of salt water (the exact amount doesn’t really matter).
Drop your scratched nickel strips in the water and wait a few days. If you don’t
see any rust forming, you’ve got pure nickel! If you see brown or orange rust,
you’ve got nickel plated steel strips.

*** The sanding/grinding wheel test - sparks from grinding
I developed this test on accident while experimenting with the first test. I
used a Dremel sanding wheel to scuff up the surface of a pure nickel strip and a
nickel plated steel strip before doing the salt water test. The pure nickel
strip was fairly uneventful, but when I used a sanding or grinding wheel on the
nickel plated steel strip, I got brilliant sparks shooting from the strip as
soon as the wheel ate through the thin nickel layer and contacted the steel.
Makes sense - steel creates spark showers. Apparently though, nickel does not,
and that makes this another great test. It’s also superior to the salt water
test because you get the result instantly. But if you’re still in doubt, go
ahead and toss the piece in salt water after you’re done grinding on it, and
that will verify the results of the grinding wheel test.

* Testing :ATTACH:

#+CAPTION: flow chart for testing used batteries
#+CAPTION: https://secondlifestorage.com/index.php?threads/18650-harvesting-flow-charts.9714
[[attachment:_20240117_134522index.php.jpeg]]

** Internal resistance
DC and AC IR, [[https://secondlifestorage.com/index.php?threads/dc-ir-vs-ac-1kh-ir-measurements.9471/post-64654][thread]]. Theoretical info on how to measure IR can be found in this paper, [[https://sci-hub.se/10.3390/s100605604][Comparison of methods for determining IR]]

Use the AC IR as screening tool before the C/D/C (charge/discharge/charge) cycle. Too high internal resistance and the cell should be discarded.

The advantage of AC IR is that the cell can be tested at a lower voltage and still give accurate results. The same cannot be said for DC IR, where the cell needs to be charged.

*** AC IR :ATTACH:

AC IR is most useful as a coarse first-level screening tool, to weed out unhealthy or damaged cells. It cannot be used for more refined analyses because it does not incorporate the non-ohmic components of IR

However, this [[https://docs.google.com/spreadsheets/d/1n6DU0VC7Yjksz2ah90VUcpw6SW6kFqQt/edit#gid=1042577799][IR cheat sheet]] give maximum and optimal AC IR values for different cells. And this [[https://secondlifestorage.com/index.php?threads/dc-ir-vs-ac-1kh-ir-measurements.9471/post-66400][post]] shows that AC & DC IR correlates(shown below as well)
#+CAPTION: AC & DC IR measurements
[[attachment:_20240117_15553520341-0abdeb4398e2d17212a3aa109e6b96a9.jpg]]

#+CAPTION: SOH vs AC & DC IR
[[attachment:_20240117_1551034755-1d484a0665d4c8b6866f08dc47a918e6.jpg]]

The current observation is that AC IR so far has been a very good indicator of a cells SOH with DC IR confirming it.
AC IR can indicate a cells SOH even at low V i.e. a cells cutoff V of ≈2.8V to 2.5V and even below that, where DC IR needs the cell to be at least ≈3.2V to get a reasonably respectable reading.

*** dc IR
DC IR match real life usage of cells best, but it's time consuming, requires 30<SoC<80% and expensive equipment to measure. [[https://secondlifestorage.com/index.php?threads/opus-bt-c3100-wire-mod-results.9374/post-64352][This post]] shows how DC IR changes for low and high SoC
30<SoC<80% correspond approximately to OCV of 3.8-3.9V. See the link in the OCV section.

- *Low frequency*, ie 1Hz, AC-IR is a valid alternative for DC-IR measurement
- AC-IR reduces measurement time dramatically
- Possible to measure resistance of 1mΩ or less accurately
- 4-terminal pair test leads required to measure low resistance with AC-IR
- the cheap standard 1kHz ac IR measuring device does not correlate with DC IR. (ie. emphasise the low frequency of 1Hz)
*** importance of IR matching
It is known that poor (DC) IR matching can lead to significant reduction in life, e.g. below
#+begin_src quote
Gogoana et al. [13] cycle-aged two cylindrical lithium iron phosphate (LFP) cells connected in parallel. They found that a 20% difference in internal resistance resulted in a 40% reduction in the useful life of the pair of cells compared to if the cells had approximately equal internal resistances. The authors attribute this to the uneven current distribution between the cells. Their results highlight that each cell will go through periods where it experiences high currents that will in turn age the cells more quickly.

Gong et al. [1] drew similar conclusions from their experimental work with 32 Ah cells. When two cells with a 20% impedance difference were connected in parallel, the peak current experienced was 40% higher than if the cells were identical. The authors also performed simulation studies, using the Mathwork's Simscape extension to Simulink to connect two equivalent circuit models (ECMs) in parallel. This is one of the few examples of parallel cell modelling within the literature from Modelling and experimental evaluation of parallel connected lithium ion cells for an electric vehicle battery system
#+end_src
https://sci-hub.se/http://dx.doi.org/10.1016/j.jpowsour.2016.01.001

** SoC or State of Charge :ATTACH:

*** Open Circuit Voltage :ATTACH:
Lead-acid batteries have a relatively discharge linear curve, which allows a good estimation of the state of charge.
Lithium-ion batteries have a much flatter discharge curve, which means that over a wide operating range, the voltage at the battery terminals changes very slightly.

#+CAPTION: Open Circuit voltage, liion VS Lead Acid
[[attachment:_20240117_141842OCV-vs-SOC-EN.png]]


Experimental OCV vs SoC is found [[https://lygte-info.dk/info/BatteryChargePercent%20UK.html][here]](see *tables*  section after the images) and summarized here
#+CAPTION: Estimated remaining capacity, OCV
[[attachment:_20240117_142835BatteryChargePercent.png]]


*** Coulomb Counting

To track the state of charge when using the battery, the most intuitive method is to follow the current by integrating it during cell use. This integration directly gives the quantity of electrical charges injected or withdrawn from the battery, thus making it possible to precisely quantify the SoC of the battery.

Small measurement errors may occur, related to the sampling frequency. To correct these marginal errors, the coulomb counter is recalibrated at each load cycle.
** SoH or State of Health

SoH = Q_{max} Q_{rated}
** Repacking
See [[https://docs.google.com/spreadsheets/d/1e2962wuNumstvv6UMLi-F7xVHQFWlMr1/edit#gid=1526562313][Repackr with IR and 80x14.xlsm]] for creating matching battery packages.
Found from https://drive.google.com/drive/folders/1UOQUXa4Kwa99KoeuNDe7EV3iSECb8iIs

* PowerWall
** Fuses

For powerwalls made of recycled cells of varying/unknown quality, fusing each cell is recommended. According to the following video it is not necessary to fuse both sides of the battery. One side is enough.
[[https://youtu.be/iL6Td8R5C1g][Dead shorting an 18650 Battery to test cell level fuses]]

5 Amps is sufficient

Three types of cell fuse
- [[https://batteryhookup.com/products/nickel-fuse-2p-wide-continuous-roll-by-the-foot-18650-cell-level-fusing][Nickel fuse, continuous roll]]
- Fuse wire, like 30AWG tinned copper. [[https://www.amazon.com/gp/product/B01LZBOSQJ][30AWG on amazon]] and [[https://youtu.be/QWZKIr5BcU0][fuse wire test]]. The [[https://en.wikipedia.org/wiki/American_wire_gauge#Tables_of_AWG_wire_sizes][fusing current is seen in this table]]
  Can be either spot welded or soldered between battery and bus bar. [[https://secondlifestorage.com/index.php?threads/experiment-soldering-18650-capacity-fade.8217/][Welding should not decrease battery performance]] if done properly
- Glass fuses. Some recommend these over fuse wire, as they don't heat/glow. I prefer the fuse wire for ease of installation and it's neater.

*** images
#+CAPTION: Spot welded fuse wire to bus bar
[[file:~/git/org/.attach/files/20220713_190008.jpg]]
[[file:~/git/org/.attach/files/20220713_190150.jpg]]

#+CAPTION: Fusing current for AWG wires. From https://en.wikipedia.org/wiki/American_wire_gauge#Tables_of_AWG_wire_sizes
[[file:~/git/org/.attach/files/AWG-wire-sizes.jpg]]

#+CAPTION: nickel fuse strip
[[file:~/git/org/.attach/files/strip.jpg]]

* LiFePO4 in car

All prices in EUR
| Name                | Description                                               |  price | url                                                                                                          |
|---------------------+-----------------------------------------------------------+--------+--------------------------------------------------------------------------------------------------------------|
| Battery             | 12V, 100A, LiFePO4 with Temp Protection,                  |    289 | https://www.litime.de/products/litime-12v-100ah-tm-lifepo4-batterie-tieftemperaturschutz-fur-trollingmotoren |
| Inverter            | Pure sine, 1000W. Try to search for a used                |    138 | https://www.ebay.de/itm/203074673536                                                                         |
| 230V charger        | 14.6V, 20A, XT60 and eu plug                              |   53.7 | https://www.aliexpress.com/item/32831716444.html                                                             |
| dc-dc charger       | 14.6V, 10A                                                |   50,4 | https://www.aliexpress.com/item/1005006128785637.html                                                        |
| 60A Circuit breaker | 12V, between alternator/starter battery and dc-dc charger |    3.8 | https://www.aliexpress.com/item/1005006161099930.html                                                        |
| 200A mega fuse      | 12V, between battery and inverter,                        |   1.16 | https://www.aliexpress.com/item/1005006113042292.html                                                        |
| XT60 connector      | 5 pcs, pairs                                              |   0.46 | https://www.aliexpress.com/item/1005005643878854.html                                                        |
| battery voltmeter   | Alt. use Coulomb counter. See link below                  |   4.66 | https://www.aliexpress.com/item/1005005210816625.html                                                        |
| 2AWG cables         | 2x, connecting battery to inverter, 30 cm, 115A @ 75℃     |  2*2.4 | https://www.aliexpress.com/item/1005005741206301.html                                                        |
| 10AWG cable         | connecting charger plug to battery, 2m, 35A @ 75℃         |   14.8 | https://www.aliexpress.com/item/1005001732356744.html                                                        |
| 14AWG cable         | connecting charger plug to battery, 2m, 20A @ 75℃         |    5.9 | https://www.aliexpress.com/item/1005001732356744.html                                                        |
| usb PD charger      | SW3518s module, only buck, 2 channel 100W                 |     10 | https://www.aliexpress.com/item/1005004331359699.html                                                        |
| boost converter     | 50W, for boosting input to SW3518s from 12V to 21V        |      2 | https://www.aliexpress.com/item/1005003044909360.html                                                        |
|---------------------+-----------------------------------------------------------+--------+--------------------------------------------------------------------------------------------------------------|
| total               |                                                           | 582.28 |                                                                                                              |
#+TBLFM: @>$3=vsum(@2..@-1)

1. The battery is recommended by https://www.mobile-solarpower.com/lithium-batteries.html
   That's Will Prowse,https://www.youtube.com/@WillProwse. According to Reddit he's legit.
2. The mega fuse between battery and inverter:
        Let's pretend we have a 1500W inverter
        1500W / 12V = 125A
        125A X 1.25(safety factor) = 156.25A
        choose 200A
3. usb PD charger: there's a *difference* between SW3518s and SW3518
4. The ampacity for the cables are from https://en.wikipedia.org/wiki/American_wire_gauge#Tables_of_AWG_wire_sizes

Alternatives
| Name                 | Description                       | price | url                                                      |
|----------------------+-----------------------------------+-------+----------------------------------------------------------|
| coulomb counter      | Instead of voltmeter              |    14 | https://www.aliexpress.com/item/1005005297360206.html    |
| dc-dc charger        | 3A, CC CV                         |   2.4 | https://www.aliexpress.com/item/1005004022655532.html    |
| dc-dc charger        | deluxe, 8A                        |    65 | https://powerwerx.com/dcdc-charger-lifepo4-8a-adjustable |
| dc-dc charger        | 30A, choose without bluetooth&nfc |   112 | https://www.aliexpress.com/item/1005002247278366.html    |
| dc-dc charger        | 8A, looks ok for the price        |    45 | https://www.aliexpress.com/item/1005005705151923.html    |
| car fuse, mini blade | 5A or 7.5A, 10 pcs                |   4.3 | https://www.aliexpress.com/item/1005006215756284.html    |
| male car plug        |                                   |   0.8 | https://www.aliexpress.com/item/1005006368260359.html    |
| female car plug      |                                   |   0.5 | https://www.aliexpress.com/item/1005005077776924.html    |
